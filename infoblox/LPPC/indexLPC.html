<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKU Search</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: row;
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #input-container {
            width: 40%;
            padding-right: 20px;
        }
        #output-container {
            width: 60%;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f9f9f9;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div id="input-container">
        <h1>SKU Search</h1>
        <textarea id="search" placeholder="Enter SKUs (one per line)" rows="10" cols="30"></textarea>
        <textarea id="discounts" placeholder="Enter Discounts (one per line)" rows="10" cols="10"></textarea>
        <button onclick="searchSKUs()">Search</button>
    </div>
    <div id="output-container">
        <h2>Results</h2>
        <table id="output-table">
            <thead>
                <tr>
                    <th>Line #</th>
                    <th>SKU</th>
                    <th>Type</th>
                    <th>Category</th>
                    <th>Discount %</th>
                    <th>NR %</th>
                    <th>Reg %</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        let skuData = {};
        const categoryMap = {
            "Subscription Software": ["Subscription", "Partner Subscription", "SaaS (Software as a Service)", "Subscriptions - Data Feed", "Software Perpetual"],
            "Hardware": ["Hardware"],
            "Maintenance Services": ["Maintenance Enterprise Direct", "Maintenance Enterprise Partner", "Maintenance ISP Partner", "Maintenance ISP Direct", "Maintenance MSP Direct", "Maintenance (General Category)"],
            "Professional Services & Training": ["Professional Services & Training"]
        };
        
        const categoryNR = {
            "Subscription Software": 11,
            "Hardware": 15,
            "Maintenance Services": 5,
            "Professional Services & Training": 5,
            "Unknown Category": 0
        };

        fetch('infobloxskudata.xlsx')
            .then(response => response.arrayBuffer())
            .then(data => {
                let workbook = XLSX.read(data, { type: 'array' });
                let sheet = workbook.Sheets[workbook.SheetNames[0]];
                let json = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                
                json.slice(1).forEach(row => {
                    if (row[0] && row[1]) {
                        skuData[row[0]] = row[1];
                    }
                });
                console.log('File loaded successfully!');
            })
            .catch(error => console.error('Error loading the file:', error));

        function categorizeType(type) {
            for (let category in categoryMap) {
                if (categoryMap[category].includes(type)) {
                    return category;
                }
            }
            return "Unknown Category";
        }

        function calculateReg(category, discount) {
            if (discount === 0) {
                return "0%";
            }
            if (category === "Hardware") {
                return `${Math.max(discount - 5, 0)}%`;
            }
            if (["Subscription Software", "Maintenance Services", "Professional Services & Training"].includes(category)) {
                return `${Math.max(discount - 3, 0)}%`;
            }
            return "0%";
        }

        function searchSKUs() {
            let skus = document.getElementById('search').value.trim().split(/\r?\n/).map(s => s.trim());
            let discounts = document.getElementById('discounts').value.trim().split(/\r?\n/).map(d => (parseFloat(d) * 100).toFixed(0));
            let tableBody = document.querySelector('#output-table tbody');
            tableBody.innerHTML = "";

            skus.forEach((sku, index) => {
                let type = skuData[sku] || "N/A";
                let category = type !== "N/A" ? categorizeType(type) : "N/A";
                let discount = parseFloat(discounts[index]) || 0;
                let nrValue = categoryNR[category] || "N/A";
                let regValue = type !== "N/A" ? calculateReg(category, discount) : "N/A";
                
                let row = `<tr>
                    <td>${index + 1}</td>
                    <td>${sku}</td>
                    <td>${type}</td>
                    <td>${category}</td>
                    <td>${discount}%</td>
                    <td>${nrValue}%</td>
                    <td>${regValue}</td>
                </tr>`;
                
                tableBody.innerHTML += row;
            });
        }
    </script>
</body>
</html>


