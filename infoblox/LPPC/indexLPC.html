<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discount Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 20px auto; background-color: #f4f4f4; padding: 20px; border-radius: 8px; box-shadow: 0px 0px 10px rgba(0,0,0,0.1); }
        .container { display: flex; gap: 20px; align-items: flex-start; justify-content: space-between; }
        .column { flex: 1; background: white; padding: 15px; border-radius: 8px; box-shadow: 0px 0px 5px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        th { background-color: #007BFF; color: white; }
        button { width: 100%; padding: 10px; background-color: #007BFF; color: white; border: none; cursor: pointer; border-radius: 4px; font-weight: bold; margin-top: 10px; }
        button:hover { background-color: #0056b3; }
        h3 { text-align: center; }
    </style>
</head>
<body>
    <h2 style="text-align: center;">Discount Calculator</h2>
    <div class="container">
        <div class="column">
            <h3>Input Data</h3>
            <table>
                <tr><th>SKU List</th><th>List Price %</th></tr>
                <tbody id="inputTable"></tbody>
            </table>
            <button onclick="calculateDiscounts()">Calculate Discounts</button>
        </div>
        <div class="column">
            <h3>Registered Prices</h3>
            <table>
                <tr><th>Price</th></tr>
                <tbody id="registeredTable"></tbody>
            </table>
            <button onclick="copyTableToClipboard('registeredTable')">Copy</button>
        </div>
        <div class="column">
            <h3>Non-Registered Prices</h3>
            <table>
                <tr><th>Price</th></tr>
                <tbody id="nonRegisteredTable"></tbody>
            </table>
            <button onclick="copyTableToClipboard('nonRegisteredTable')">Copy</button>
        </div>
    </div>
    
    <script>
        let skuTypeMap = {};
        
        async function fetchExcelData() {
            const response = await fetch('infobloxskudata.xlsx');
            const arrayBuffer = await response.arrayBuffer();
            const workbook = XLSX.read(arrayBuffer, { type: 'array' });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
            
            data.forEach((row, index) => {
                if (index > 0 && row[0] && row[1]) {
                    skuTypeMap[row[0].trim().toUpperCase()] = row[1].trim();
                }
            });
        }
        
        function populateInputTable(skus, prices) {
            const table = document.getElementById("inputTable");
            table.innerHTML = "";
            skus.forEach((sku, index) => {
                let row = `<tr><td>${sku}</td><td>${prices[index]}</td></tr>`;
                table.innerHTML += row;
            });
        }
        
        async function calculateDiscounts() {
            if (Object.keys(skuTypeMap).length === 0) await fetchExcelData();
            const typeMapping = {
                "Subscription Software": 11,
                "Hardware": 15,
                "Hardware Maintenance": 5,
                "Professional Services & Training": 5,
            };
            
            let skus = prompt("Paste SKU List (one per line)").split("\n").map(s => s.trim().toUpperCase());
            let prices = prompt("Paste List Price % (one per line)").split("\n").map(p => parseFloat(p.trim()) || 0);
            
            populateInputTable(skus, prices);
            
            let registeredTable = document.getElementById("registeredTable");
            let nonRegisteredTable = document.getElementById("nonRegisteredTable");
            registeredTable.innerHTML = "";
            nonRegisteredTable.innerHTML = "";
            
            skus.forEach((sku, index) => {
                const type = skuTypeMap[sku] || "Other";
                let registeredPrice = prices[index] === 0 ? 0 : (type === "Hardware" ? prices[index] - 0.05 : prices[index] - 0.03);
                let nonRegisteredPrice = typeMapping.hasOwnProperty(type) ? typeMapping[type] + "%" : "0%";
                
                registeredTable.innerHTML += `<tr><td>${registeredPrice.toFixed(2)}</td></tr>`;
                nonRegisteredTable.innerHTML += `<tr><td>${nonRegisteredPrice}</td></tr>`;
            });
        }
        
        function copyTableToClipboard(tableId) {
            let table = document.getElementById(tableId);
            let text = "";
            for (let row of table.rows) {
                text += row.cells[0].innerText + "\n";
            }
            navigator.clipboard.writeText(text).then(() => alert("Copied!"));
        }
    </script>
</body>
</html>
